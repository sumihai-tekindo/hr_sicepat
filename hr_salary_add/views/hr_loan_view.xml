<openerp>
    <data>
        <record model="ir.actions.act_window" id="action_loan_type">
            <field name="name">Tipe Pinjaman</field>
            <field name="res_model">hr.loan.type</field>
            <field name="view_mode">tree,form</field>
        </record>
        <record model="ir.ui.view" id="loan_type_search_view">
            <field name="name">loan.type.search</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name" filter_domain="['|', ('name','ilike',self), ('code','ilike',self)]"/>
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="loan_type_tree_view">
            <field name="name">loan.type.tree</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="code"/>
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="loan_type_form_view">
            <field name="name">loan.type.form</field>
            <field name="model">hr.loan.type</field>
            <field name="arch" type="xml">
                <form string="Loan Type Form">
                    <group col="4">
                        <field name="name"/>
                        <field name="code"/>
                    </group>
                </form>
            </field>
        </record>
    	
        <menuitem id="menu_tipe_pinjaman" name="Tipe Pinjaman" 
        		  parent="hr_salary_add.hr_sicepat_configuration"
                  action="action_loan_type"/>
        
        <record id="hr_loan_submit_view" model="ir.ui.view">
            <field name="name">hr.loan.submit.form</field>
            <field name="model">hr.loan.submit</field>
            <field name="arch" type="xml">
                <form string="Submit Loan">
                    <p class="oe_grey">
                        This wizard will submit the all the selected open loan.
                    </p>
                    <footer>
                        <button string="Submit" name="loan_submit" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <act_window id="loan_submit_action"
            name="Submit"
            src_model="hr.loan"
            res_model="hr.loan.submit"
            view_type="form" view_mode="form"
            key2="client_action_multi" target="new"/>
        
        <record id="hr_loan_approve_view" model="ir.ui.view">
            <field name="name">hr.loan.approve.form</field>
            <field name="model">hr.loan.approve</field>
            <field name="arch" type="xml">
                <form string="Approve Loan">
                    <p class="oe_grey">
                        This wizard will approve the all the selected submit loan.
                    </p>
                    <footer>
                        <button string="Approve" name="loan_approve" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <act_window id="loan_approve_action"
            name="Approve"
            src_model="hr.loan"
            res_model="hr.loan.approve"
            view_type="form" view_mode="form"
            key2="client_action_multi" target="new"/>


        <record id="loan_reject_wizard_view" model="ir.ui.view">
            <field name="name">Reject Loan</field>
            <field name="model">hr.loan.reject_wizard</field>
            <field name="arch" type="xml">
                <form string="Reject Loan">
                    <field name="loan_ids"/>
                    <footer>
                        <button string="Reject" name="reject_loan_button" type="object" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>
        <record id="loan_reject_wizard_tree_view" model="ir.ui.view">
            <field name="name">Loan Reject View</field>
            <field name="model">hr.loan.reject</field>
            <field name="arch" type="xml">
                <!-- the user list is editable, but one cannot add or delete rows -->
                <tree string="Loan" editable="bottom" create="false" delete="false">
                    <field name="loan_id"/>
                    <field name="employee_id"/>
                    <field name="nilai_pinjaman"/>
                    <field name="alasan_reject" required="True"/>
                </tree>
            </field>
        </record>
        
        <record id="action_wizard_reject_loan" model="ir.actions.act_window">
            <field name="name">Reject Loan</field>
            <field name="res_model">hr.loan.reject_wizard</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="hr_salary_add.loan_reject_wizard_view"/>
            <field name="target">new</field>
        </record>
        <record model="ir.values" id="values_wizard_reject_loan">
            <field name="model_id" ref="model_hr_loan" />
            <field name="name">action_wizard_reject_loan</field>
            <field name="key2">client_action_multi</field>
            <field name="value" eval="'ir.actions.act_window,' + str(ref('hr_salary_add.action_wizard_reject_loan'))" />
            <field name="key">action</field>
            <field name="model">hr.loan</field>
        </record>

        <record id="hr_loan_close_view" model="ir.ui.view">
            <field name="name">hr.loan.close.form</field>
            <field name="model">hr.loan.close</field>
            <field name="arch" type="xml">
                <form string="Close Loan">
                    <p class="oe_grey">
                        This wizard will close the selected approve loan.
                    </p>
                    <group col="4">
                    	<field name="loan_id"/>
                    	<field name="loan_type"/>
                    	<field name="employee_id"/>
                    	<field name="nilai_pinjaman"/>
                    </group>
                    <label for="notes"/>
                    <field name="notes"/>
                    <footer>
                        <button string="Close" name="close_button" type="object" default_focus="1" class="oe_highlight"/>
                        or
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
        <act_window id="loan_close_action"
            name="Close"
            src_model="hr.loan"
            res_model="hr.loan.close"
            view_type="form" view_mode="form"
            key2="client_action_multi" target="new"/>
        
        
<!--    START LOAN  -->
        <record model="ir.actions.act_window" id="loan_action">
            <field name="name">Pinjaman Karyawan</field>
            <field name="res_model">hr.loan</field>
            <field name="view_mode">tree,form</field>
        </record>
        <record model="ir.ui.view" id="loan_search_view">
            <field name="name">loan.search</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <search string="Loan">
                    <field name="name"/>
                    <field name="tanggal"/>
                    <field name="employee_id"/>
                    <field name="jabatan_id"/>
                    <field name="department_id"/>
                    <field name="loan_type"/>
                    <separator/>
            		<filter name="open" string="Open" domain="[('state','=','draft')]"/>
            		<filter name="submit" string="Submit" domain="[('state','=','submit')]"/>
            		<filter name="reject" string="Reject" domain="[('state','=','reject')]"/>
            		<filter name="approved" string="Approved" domain="[('state','=','approved')]"/>
            		<separator/>
            		<filter domain="[('state','=','draft')]" help="To Submit"/>
            		<filter domain="[('state','=','submit')]" help="To Approve"/>
                    <group expand="0" string="Group By">
	                	<filter name="group_by_state" string="Status" context="{'group_by':'state'}"/>
	                	<filter name="group_by_employee" string="Karyawan" context="{'group_by':'employee_id'}"/>
	                	<filter name="group_by_jabatan" string="Jabatan" context="{'group_by':'jabatan_id'}"/>
	                	<filter name="group_by_department" string="Cabang" context="{'group_by':'department_id'}"/>
	                	<filter name="group_by_loan_type" string="Loan Type" context="{'group_by':'loan_type'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="loan_tree_view">
            <field name="name">loan.tree</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <tree string="Loan Tree">
                    <field name="name"/>
                    <field name="loan_type"/>
                    <field name="tanggal"/>
                    <field name="employee_id"/>
                    <field name="jabatan_id"/>
                    <field name="department_id"/>
                    <field name="total_angsuran" sum="Total Pinjaman"/>
                    <field name="total_bayar_angsuran" sum="Total Pembayaran Angsuran"/>
                    <field name="sisa_angsuran" sum="Sisa Angsuran"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="loan_form_view">
            <field name="name">loan.form</field>
            <field name="model">hr.loan</field>
            <field name="arch" type="xml">
                <form string="Loan Form">
                    <header>
<!--                        <button name="compute_loan_line" type="object"-->
<!--                            string="Compute" states="draft" class="oe_highlight"/>-->
<!--                        <button name="compute_loan_line" type="object"-->
<!--                            string="Compute" states="submit"/>-->
                        <button name="action_submit" type="object"
                            string="Submit" states="draft" class="oe_highlight"/>
                        <button name="action_approve" type="object"
                            string="Approve" states="submit" class="oe_highlight"/>
                        <button name="%(action_wizard_reject_loan)d" type="action"
                            string="Reject" states="submit" class="oe_highlight"/>
                        <button name="%(loan_close_action)d" type="action"
                            string="Close" states="approved" class="oe_highlight"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,submit,approved"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="loan_type" widget="selection"/>
                                <field name="tanggal"/>
                                <field name="employee_id"/>
                                <field name="jabatan_id" options="{'no_open': True}"/>
                                <field name="department_id" options="{'no_open': True}"/>
                                <field name="address_home_id" invisible="1"/>
                                <field name="pinjaman_unpaid"/>
<!--                                <field name="type"/>-->
                            </group>
                            <group>
                                <field name="nilai_pinjaman"/>
                                <field name="tenor_angsuran"/>
                                <field name="nilai_angsuran"/>
                                <field name="tanggal_awal_angsuran"/>
                                <field name="payment_method" on_change="payment_method_change(payment_method)"/>
                                <field name="bank_account_id" options="{'no_create_edit': True, 'no_open': True}" attrs="{'invisible':[('payment_method','!=','bank')],'required':[('payment_method','=','bank')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Installments" attrs="{'invisible':[('state','not in',('approved', 'close'))]}">
                                <field name="loan_line" options="{'reload_on_button': true}" readonly="[('state','not in',('approved'))]">
                                    <tree string="Loan Line" editable="bottom">
                                        <field name="loan_id" invisible="1"/>
                                        <field name="paid" readonly="1"/>
                                        <field name="tanggal_angsuran" attrs="{'readonly':[('posted','=',True)]}"/>
                                        <field name="nilai_angsuran" attrs="{'readonly':[('posted','=',True)]}"/>
                                        <field name="keterangan" attrs="{'readonly':[('posted','=',True)]}"/>
                                        <button name="action_post" icon="kanban-apply" string="Post" type="object" attrs="{'invisible':[('posted','=',True)]}"/>
                                        <button name="action_undo_post" icon="gtk-undo" string="Unpost" type="object" attrs="{'invisible':['|',('posted','=',False),('paid','=',True)]}" groups=""/>
                                        <field name="posted" invisible="1"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="total_angsuran"/>
<!--                                    <div>-->
<!--                                        <label for="total_bayar_angsuran"/>-->
<!--                                        <button name="button_reset_balance_total" states="draft"-->
<!--                                            string="(update)" class="oe_link oe_edit_only"-->
<!--                                            type="object" help="Recompute Balance"/>-->
<!--                                    </div>-->
<!--                                    <field name="total_bayar_angsuran" nolabel="1"/>-->
                                    <field name="total_bayar_angsuran"/>
                                    <field name="sisa_angsuran" class="oe_subtotal_footer_separator"/>
                                </group>
                                <div class="oe_clear"/>
                            </page>
							<page string="Notes">
	                            <div class="oe_clear">
	                                <label for="notes"/>
	                            </div>
	                            <field name="notes" class="oe_inline" placeholder="Additional notes..."/>
	                            <div class="oe_clear">
	                                <label for="alasan_reject" attrs="{'invisible':[('state','!=','reject')]}"/>
	                            </div>
	                            <field name="alasan_reject" class="oe_inline" placeholder="Additional notes..." attrs="{'invisible':[('state','!=','reject')]}"/>
							</page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
<!--    END OF LOAN    -->
    
<!--    START MENU ITEM    -->
        <menuitem id="loan_menu" name="Pinjaman" 
                  parent="hr_sicepat_salary"
                  action="loan_action" sequence="9"/>
<!--    END OF MENU ITEM        -->
                
        <record id="act_hr_employee_loan_request" model="ir.actions.act_window">
            <field name="res_model">hr.loan</field>
            <field name="name">Pinjaman</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_employee_id': [active_id], 'default_employee_id': active_id}</field>
        </record>
        <record id="view_employee_form_loan" model="ir.ui.view">
            <field name="name">hr.employee.form.loan</field>
            <field name="model">hr.employee</field>
            <field name="inherit_id" ref="hr_salary_add.view_hr_employee_form"/>
            <field name="arch" type="xml">
                <data>
                    <xpath expr="//group[@string='Other Information']" position="inside">
                        <field name="sisa_pinjaman"/>
                    </xpath>
                    <xpath expr="//div[@name='button_box']" position="inside">
                        <button name="%(act_hr_employee_loan_request)d"  
                            class="oe_stat_button" 
                            icon="fa-money" 
                            type="action" 
                            groups="base.group_hr_user">
                            <field name="jumlah_pinjaman_x" widget="statinfo" string="Pinjaman"/>
                        </button>
                    </xpath>
                </data>
            </field>
        </record>
    </data>
</openerp>